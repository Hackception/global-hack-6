<link rel=import href=../bower_components/polymer/polymer.html>
<link rel=import href=shared-styles.html>
<link rel=import href=../bower_components/iron-pages/iron-pages.html>
<link rel=import href=../bower_components/iron-selector/iron-selector.html>
<link rel=import href=elements/hc-manage-entity.html>
<link rel=import href=../../bower_components/iron-ajax/iron-ajax.html>
<link rel=import href=elements/hc-data-utils-behavior.html>

<dom-module id=hc-manage>
  <template>
    <style include=shared-styles>
      :host {
        display: block;
      }
    </style>

    <div class=card>
      <h1>Manage</h1>

      <iron-selector
        selected={{__selected}}
        attr-for-selected=name
        >
        <div name=cocs>COC</div>
        <div name=locations>Locations</div>
        <div name=programs>Programs</div>
        <div name=referrals>Referrals</div>
      </iron-selector>

      <hc-manage-entity
        language=[[language]]
        items={{items}}
        dirty={{__dirty}}
      ></hc-manage-entity>

      <iron-ajax
        auto
        url=[[_getRoute(baseUrl,__selected)]]
        headers=[[headers]]
        on-response=_getItems
      ></iron-ajax>
    </div>
  </template>
  <script>
    Polymer({
      is: 'hc-manage',
      behaviors: [window.hc.dataUtilsBehavior],
      properties: {
        items: {
          type: Array,
          value: () => []
        },
        baseUrl: String,
        __dirty: {
          type: Boolean,
          value: false
        }
      },
      _getRoute(baseUrl, selected) {
        if (this.__dirty) console.error('you have unsaved data...');
        return this.__dirty ? undefined : `${baseUrl}/${selected}`;
      },
      _getItems(event) {
        this.set('items', this.convertObjToArray(event.detail.response));
      }
    });
  </script>
</dom-module>
