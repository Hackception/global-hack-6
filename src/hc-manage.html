<link rel=import href=../bower_components/polymer/polymer.html>
<link rel=import href=shared-styles.html>
<link rel=import href=../bower_components/iron-pages/iron-pages.html>
<link rel=import href=../bower_components/paper-tabs/paper-tabs.html>
<link rel=import href=../bower_components/paper-tabs/paper-tab.html>
<link rel=import href=elements/hc-manage-entity.html>
<link rel=import href=../bower_components/iron-ajax/iron-ajax.html>

<dom-module id=hc-manage>
  <template>
    <style include=shared-styles>
      :host {
        display: block;
      }

      h1 {
        padding: 0 24px;
      }

      .menu paper-tabs {
        --paper-tab-ink: var(--dark-primary-color);
        --paper-tab: {
          background-color: var(--default-primary-color);
          color: var(--text-primary-color);
        };
      }
    </style>

    <div class="menu">
      <h1>Manage</h1>

      <paper-tabs
        selected={{__selected}}
        attr-for-selected=name
        >
        <paper-tab name=cocs>COC</paper-tab>
        <paper-tab name=locations>Locations</paper-tab>
        <paper-tab name=programs>Programs</paper-tab>
        <paper-tab name=referrals>Referrals</paper-tab>
      </paper-tabs>
    </div>

    <div class=card>
      <hc-manage-entity
        language=[[language]]
        items={{items}}
        dirty={{__dirty}}
      ></hc-manage-entity>

      <iron-ajax
        auto
        url=[[_getRoute(baseUrl,__selected)]]
        headers=[[headers]]
        on-response=_getItems
      ></iron-ajax>
    </div>
  </template>
  <script>
    Polymer({
      is: 'hc-manage',
      properties: {
        items: {
          type: Array,
          value: () => []
        },
        baseUrl: String,
        __dirty: {
          type: Boolean,
          value: false
        },
        __selected: {
          type: String,
          value: 'cocs'
        }
      },
      _getRoute(baseUrl, selected) {
        if (this.__dirty) console.error('you have unsaved data...');
        return this.__dirty ? undefined : `${baseUrl}/${selected}`;
      },
      _getItems(event) {
        const data = event.detail.response;
        this.set('items', Object.keys(data).map(key => Object.assign({key}, data[key])));
      },
    });
  </script>
</dom-module>
